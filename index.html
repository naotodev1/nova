<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nova - Assistente Virtual</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #6e8efb, #a777e3);
            --secondary-gradient: linear-gradient(to right, #6e8efb, #a777e3);
            --background-light: #f8f9fa;
            --background-dark: #1a1a1a;
            --card-light: #ffffff;
            --card-dark: #2d2d2d;
            --text-light: #333;
            --text-dark: #ffffff;
            --border-light: #eee;
            --border-dark: #444;
        }

        body {
            background: var(--primary-gradient);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            transition: all 0.3s ease;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #2c3e50, #4a6741);
        }

        .app-container {
            width: 100%;
            max-width: 400px;
            height: 600px;
            background-color: var(--card-light);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
            transition: all 0.3s ease;
        }

        .dark-mode .app-container {
            background-color: var(--card-dark);
            color: var(--text-dark);
        }

        /* Welcome Screen */
        .welcome-screen {
            display: flex;
            flex-direction: column;
            height: 100%;
            padding: 20px;
            text-align: center;
            background: var(--card-light);
            transition: all 0.3s ease;
        }

        .dark-mode .welcome-screen {
            background: var(--card-dark);
        }

        .welcome-header {
            margin-bottom: 30px;
        }

        .nova-logo {
            background: var(--secondary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 10px;
        }

        .welcome-subtitle {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 20px;
        }

        .dark-mode .welcome-subtitle {
            color: #ccc;
        }

        .welcome-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }

        .welcome-card {
            background: var(--background-light);
            border: 1px solid var(--border-light);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .dark-mode .welcome-card {
            background: #333;
            border-color: var(--border-dark);
            color: var(--text-dark);
        }

        .welcome-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .welcome-card h3 {
            font-size: 0.9rem;
            margin-bottom: 5px;
            background: var(--secondary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .start-chat-btn {
            background: var(--secondary-gradient);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: auto;
            transition: transform 0.2s ease;
        }

        .start-chat-btn:hover {
            transform: scale(1.05);
        }

        /* Chat Screen */
        .chat-screen {
            display: none;
            flex-direction: column;
            height: 100%;
        }

        .chat-header {
            background: var(--secondary-gradient);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .chatbot-avatar {
            width: 60px;
            height: 60px;
            background-color: white;
            border-radius: 50%;
            margin: 0 auto 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .chatbot-avatar::before {
            content: "";
            width: 40px;
            height: 40px;
            background: var(--secondary-gradient);
            border-radius: 50%;
            display: block;
        }

        .chatbot-name {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .menu-btn, .voice-btn {
            position: absolute;
            top: 20px;
            background: rgba(255, 255, 255, 0.2);
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-weight: bold;
            border: none;
            color: white;
        }

        .menu-btn {
            left: 20px;
        }

        .voice-btn {
            right: 20px;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background-color: var(--background-light);
            transition: all 0.3s ease;
        }

        .dark-mode .chat-messages {
            background-color: var(--background-dark);
        }

        .message {
            max-width: 80%;
            padding: 12px 15px;
            border-radius: 18px;
            line-height: 1.4;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .bot-message {
            background-color: #e8ebf8;
            border-bottom-left-radius: 5px;
            align-self: flex-start;
            color: #333;
        }

        .dark-mode .bot-message {
            background-color: #4a5568;
            color: var(--text-dark);
        }

        .user-message {
            background-color: #6e8efb;
            color: white;
            border-bottom-right-radius: 5px;
            align-self: flex-end;
        }

        .audio-message {
            background-color: #a777e3;
            color: white;
            border-radius: 18px;
            padding: 12px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .play-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
        }

        .typing-indicator {
            display: none;
            background-color: #e8ebf8;
            padding: 12px 15px;
            border-radius: 18px;
            align-self: flex-start;
            margin-bottom: 10px;
        }

        .dark-mode .typing-indicator {
            background-color: #4a5568;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background-color: #a777e3;
            border-radius: 50%;
            display: inline-block;
            margin: 0 2px;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingAnimation {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }

        .chat-input {
            display: flex;
            padding: 15px;
            background-color: var(--card-light);
            border-top: 1px solid var(--border-light);
            gap: 10px;
            transition: all 0.3s ease;
        }

        .dark-mode .chat-input {
            background-color: var(--card-dark);
            border-color: var(--border-dark);
        }

        .chat-input input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid var(--border-light);
            border-radius: 25px;
            outline: none;
            font-size: 1rem;
            background: var(--card-light);
            color: var(--text-light);
            transition: all 0.3s ease;
        }

        .dark-mode .chat-input input {
            background: #333;
            border-color: var(--border-dark);
            color: var(--text-dark);
        }

        .send-btn, .mic-btn {
            background: var(--secondary-gradient);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            transition: transform 0.2s ease;
        }

        .send-btn:hover, .mic-btn:hover {
            transform: scale(1.05);
        }

        .mic-btn.recording {
            background: #e74c3c;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Menu Modal */
        .menu-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .menu-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--card-light);
            border-radius: 15px;
            padding: 20px;
            width: 300px;
            max-width: 90%;
            transition: all 0.3s ease;
        }

        .dark-mode .menu-content {
            background: var(--card-dark);
            color: var(--text-dark);
        }

        .menu-item {
            padding: 15px;
            border-bottom: 1px solid var(--border-light);
            cursor: pointer;
            transition: background-color 0.2s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .dark-mode .menu-item {
            border-color: var(--border-dark);
        }

        .menu-item:hover {
            background-color: var(--background-light);
        }

        .dark-mode .menu-item:hover {
            background-color: #333;
        }

        .menu-item:last-child {
            border-bottom: none;
        }

        .dark-mode-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 25px;
            background-color: #ccc;
            border-radius: 15px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .toggle-switch.active {
            background-color: #6e8efb;
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 21px;
            height: 21px;
            background-color: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(25px);
        }

        /* Info Modal */
        .info-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .info-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--card-light);
            border-radius: 15px;
            padding: 20px;
            width: 350px;
            max-width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            transition: all 0.3s ease;
        }

        .dark-mode .info-content {
            background: var(--card-dark);
            color: var(--text-dark);
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
        }

        .dark-mode .close-btn {
            color: var(--text-dark);
        }

        .learning-indicator {
            position: absolute;
            top: 10px;
            right: 60px;
            width: 10px;
            height: 10px;
            background: #2ecc71;
            border-radius: 50%;
            animation: blink 2s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 10px 15px;
            background-color: var(--card-light);
            border-top: 1px solid var(--border-light);
            transition: all 0.3s ease;
        }

        .dark-mode .suggestions {
            background-color: var(--card-dark);
            border-color: var(--border-dark);
        }

        .suggestion-chip {
            background-color: #f0f3ff;
            color: #6e8efb;
            padding: 8px 15px;
            border-radius: 18px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .dark-mode .suggestion-chip {
            background-color: #4a5568;
            color: #a777e3;
        }

        .suggestion-chip:hover {
            background-color: #e2e7ff;
        }

        .dark-mode .suggestion-chip:hover {
            background-color: #5a6578;
        }

        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Welcome Screen -->
        <div class="welcome-screen" id="welcomeScreen">
            <div class="welcome-header">
                <h1 class="nova-logo">Nova</h1>
                <p class="welcome-subtitle">Sua assistente virtual</p>
            </div>
            
            <div class="welcome-cards">
                <div class="welcome-card" onclick="showInfo('commands')">
                    <h3>/Comandos</h3>
                    <p>Veja todos os comandos dispon√≠veis</p>
                </div>
                <div class="welcome-card" onclick="showInfo('dev')">
                    <h3>/Sobre o dev</h3>
                    <p>Conhe√ßa o desenvolvedor</p>
                </div>
                <div class="welcome-card" onclick="showInfo('nova')">
                    <h3>/Sobre a Nova</h3>
                    <p>Saiba mais sobre mim</p>
                </div>
                <div class="welcome-card" onclick="openFeedback()">
                    <h3>/Feedback</h3>
                    <p>Envie sua opini√£o</p>
                </div>
            </div>
            
            <button class="start-chat-btn" onclick="startChat()">Iniciar Conversa</button>
        </div>

        <!-- Chat Screen -->
        <div class="chat-screen" id="chatScreen">
            <div class="chat-header">
                <button class="back-btn" onclick="goBack()">‚Üê</button>
                <button class="menu-btn" onclick="toggleMenu()">‚ò∞</button>
                <div class="chatbot-avatar"></div>
                <h2 class="chatbot-name">Nova</h2>
                <button class="voice-btn" onclick="toggleTTS()">üîä</button>
                <div class="learning-indicator" title="Aprendendo continuamente"></div>
            </div>

            <div class="chat-messages" id="chatMessages">
                <div class="message bot-message">
                    Ol√°! Eu sou a Nova, sua assistente virtual. üòä<br>
                    Como posso ajudar voc√™ hoje?
                </div>
                <div class="typing-indicator" id="typingIndicator">
                    <span class="typing-dot"></span>
                    <span class="typing-dot"></span>
                    <span class="typing-dot"></span>
                </div>
            </div>

            <div class="suggestions" id="suggestions">
                <div class="suggestion-chip">Como voc√™ funciona?</div>
                <div class="suggestion-chip">Que horas s√£o?</div>
                <div class="suggestion-chip">Me conte uma piada</div>
                <div class="suggestion-chip">Qual √© a data hoje?</div>
            </div>

            <div class="chat-input">
                <input type="text" placeholder="Digite sua mensagem..." id="userInput">
                <button class="mic-btn" id="micBtn" onclick="toggleRecording()">üé§</button>
                <button class="send-btn" id="sendBtn" onclick="sendMessage()">‚û§</button>
            </div>
        </div>

        <!-- Menu Modal -->
        <div class="menu-modal" id="menuModal" onclick="closeMenu()">
            <div class="menu-content" onclick="event.stopPropagation()">
                <div class="menu-item dark-mode-toggle" onclick="toggleDarkMode()">
                    <span>üåô</span>
                    <span>Modo Noturno</span>
                    <div class="toggle-switch" id="darkModeToggle">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
                <div class="menu-item" onclick="openFeedback()">
                    <span>üí¨</span>
                    <span>Feedback</span>
                </div>
                <div class="menu-item" onclick="openTerms()">
                    <span>üìÑ</span>
                    <span>Termos de Uso</span>
                </div>
                <div class="menu-item" onclick="clearChat()">
                    <span>üóëÔ∏è</span>
                    <span>Limpar Conversa</span>
                </div>
            </div>
        </div>

        <!-- Info Modal -->
        <div class="info-modal" id="infoModal" onclick="closeInfo()">
            <div class="info-content" onclick="event.stopPropagation()">
                <button class="close-btn" onclick="closeInfo()">√ó</button>
                <div id="infoContent"></div>
            </div>
        </div>
    </div>

    <script>
        class NovaAssistant {
            constructor() {
                this.isRecording = false;
                this.recognition = null;
                this.synthesis = window.speechSynthesis;
                this.isTTSEnabled = true;
                this.isDarkMode = this.getStorageItem('darkMode') === 'true';
                this.userPreferences = this.getStorageItem('novaPreferences', {});
                this.conversationContext = [];
                this.learnedResponses = this.getStorageItem('novaLearning', {});
                
                this.init();
                this.setupSpeechRecognition();
                this.applyDarkMode();
            }

            getStorageItem(key, defaultValue = null) {
                try {
                    if (typeof Storage !== 'undefined' && localStorage) {
                        const item = localStorage.getItem(key);
                        return item ? JSON.parse(item) : defaultValue;
                    }
                } catch (e) {
                    console.warn('localStorage n√£o dispon√≠vel:', e);
                }
                return defaultValue;
            }

            setStorageItem(key, value) {
                try {
                    if (typeof Storage !== 'undefined' && localStorage) {
                        localStorage.setItem(key, JSON.stringify(value));
                        return true;
                    }
                } catch (e) {
                    console.warn('Erro ao salvar no localStorage:', e);
                }
                return false;
            }

            init() {
                this.setupEventListeners();
                this.showWelcomeMessage();
            }

            setupEventListeners() {
                document.getElementById('userInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.sendMessage();
                });

                document.querySelectorAll('.suggestion-chip').forEach(chip => {
                    chip.addEventListener('click', () => {
                        document.getElementById('userInput').value = chip.textContent;
                        this.sendMessage();
                    });
                });
            }

            setupSpeechRecognition() {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    this.recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                    this.recognition.lang = 'pt-BR';
                    this.recognition.continuous = false;
                    this.recognition.interimResults = false;

                    this.recognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        document.getElementById('userInput').value = transcript;
                        this.sendMessage();
                    };

                    this.recognition.onend = () => {
                        this.stopRecording();
                    };
                }
            }

            showWelcomeMessage() {
                setTimeout(() => {
                    if (document.getElementById('chatScreen').style.display !== 'flex') return;
                    this.addMessage("Voc√™ pode me perguntar sobre v√°rias coisas! Digite /ajuda para ver todos os meus comandos. üí°");
                }, 1500);
            }

            sendMessage() {
                const input = document.getElementById('userInput').value.trim();
                if (!input) return;

                this.addMessage(input, true);
                document.getElementById('userInput').value = '';
                
                this.conversationContext.push({role: 'user', content: input});
                this.showTypingIndicator();

                setTimeout(() => {
                    this.hideTypingIndicator();
                    this.generateResponse(input);
                }, 1000 + Math.random() * 1000);
            }

            addMessage(message, isUser = false, isAudio = false) {
                const messagesContainer = document.getElementById('chatMessages');
                const messageElement = document.createElement('div');
                
                if (isAudio) {
                    messageElement.classList.add('message', 'audio-message');
                    messageElement.innerHTML = `
                        <button class="play-btn" onclick="nova.playAudio('${message}')">‚ñ∂</button>
                        <span>Mensagem de √°udio</span>
                    `;
                } else {
                    messageElement.classList.add('message');
                    messageElement.classList.add(isUser ? 'user-message' : 'bot-message');
                    messageElement.innerHTML = message.replace(/\n/g, '<br>');
                }

                messagesContainer.appendChild(messageElement);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;

                if (!isUser && this.isTTSEnabled && !isAudio) {
                    this.speak(message);
                }
            }

            generateResponse(input) {
                const lowerInput = input.toLowerCase().trim();
                let response = '';

                // Verificar aprendizado personalizado primeiro
                if (this.learnedResponses[lowerInput]) {
                    response = this.learnedResponses[lowerInput];
                    this.addMessage(response);
                    this.conversationContext.push({role: 'assistant', content: response});
                    return;
                }

                // Sauda√ß√µes variadas
                const greetings = ['oi', 'ol√°', 'ola', 'hey', 'eai', 'e ai', 'bom dia', 'boa tarde', 'boa noite'];
                if (greetings.some(g => lowerInput.includes(g))) {
                    const responses = [
                        "Ol√°! Como posso ajudar voc√™ hoje? üòä",
                        "Oi! Em que posso ser √∫til? üåü",
                        "Ol√°! Que bom conversar com voc√™! üòÑ",
                        "Hey! Pronta para ajudar! üíô",
                        "Eai! O que voc√™ gostaria de saber? üöÄ"
                    ];
                    response = this.getRandomResponse(responses);
                }
                // Estado/Como est√°
                else if (lowerInput.includes('como voc√™ est√°') || lowerInput.includes('tudo bem') || lowerInput.includes('como vai')) {
                    const responses = [
                        "Estou muito bem, obrigada! Pronta para ajudar voc√™! üí´",
                        "Estou √≥tima! Como posso tornar seu dia melhor? ‚ú®",
                        "Estou funcionando perfeitamente! E voc√™, como est√°? üòä",
                        "Muito bem! Cada conversa me deixa mais esperta! üß†",
                        "Excelente! Sempre animada para aprender algo novo! üéâ"
                    ];
                    response = this.getRandomResponse(responses);
                }
                // Agradecimentos
                else if (lowerInput.includes('obrigad') || lowerInput.includes('valeu') || lowerInput.includes('agrade√ßo')) {
                    const responses = [
                        "De nada! Estou sempre aqui para ajudar! üíô",
                        "Por nada! Fico feliz em poder ajudar! üòä",
                        "N√£o h√° de qu√™! Estou √† disposi√ß√£o! üåü",
                        "Foi um prazer ajudar! üíú",
                        "Sempre √†s ordens! ü´°"
                    ];
                    response = this.getRandomResponse(responses);
                }
                // Hora atual
                else if (lowerInput.includes('horas') || lowerInput.includes('hora') || lowerInput === '/hora') {
                    const now = new Date();
                    const time = now.toLocaleTimeString('pt-BR');
                    const date = now.toLocaleDateString('pt-BR');
                    response = `Agora s√£o ${time} do dia ${date} ‚è∞`;
                }
                // Data atual
                else if (lowerInput.includes('data') || lowerInput.includes('dia') && lowerInput.includes('hoje')) {
                    const now = new Date();
                    const options = { 
                        weekday: 'long', 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    };
                    const date = now.toLocaleDateString('pt-BR', options);
                    response = `Hoje √© ${date} üìÖ`;
                }
                // Comandos
                else if (lowerInput === '/ajuda' || lowerInput === 'ajuda' || lowerInput === 'comandos') {
                    response = `Aqui est√£o meus comandos dispon√≠veis:
‚Ä¢ /ajuda - Mostra os comandos dispon√≠veis
‚Ä¢ /piada - Conta uma piada aleat√≥ria
‚Ä¢ /hora - Mostra a hora atual
‚Ä¢ /data - Mostra a data atual
‚Ä¢ /clima - Informa√ß√µes sobre o tempo
‚Ä¢ /limpar - Limpa a conversa
‚Ä¢ /aprenda [pergunta] [resposta] - Me ensina algo novo
‚Ä¢ /sobre - Informa√ß√µes sobre mim

Tamb√©m posso conversar sobre diversos temas! üéØ`;
                }
                // Piadas
                else if (lowerInput === '/piada' || lowerInput.includes('piada') || lowerInput.includes('conte uma piada')) {
                    const jokes = [
                        "Por que o Java foi ao psic√≥logo? Porque tinha problemas de classe! üòÑ",
                        "O que um c√≥digo disse para o outro? Voc√™ √© o ; da minha vida! üíª",
                        "Por que o developer saiu da festa? Porque n√£o havia node.js! üéâ",
                        "Como voc√™ chama um programador que n√£o consegue dormir? Um ins√¥nico! üò¥",
                        "Por que os programadores preferem o escuro? Porque a luz causa bugs! üêõ",
                        "O que acontece quando voc√™ cruza um programador com um m√°gico? Voc√™ consegue c√≥digo que desaparece! ‚ú®"
                    ];
                    response = this.getRandomResponse(jokes);
                }
                // Clima/Tempo
                else if (lowerInput === '/clima' || lowerInput.includes('tempo') || lowerInput.includes('clima')) {
                    response = "No momento, n√£o consigo acessar dados de previs√£o do tempo em tempo real. Mas posso sugerir que voc√™ verifique um app de previs√£o do tempo para informa√ß√µes precisas! üå§Ô∏è";
                }
                // Aprendizado
                else if (lowerInput.startsWith('/aprenda ')) {
                    const parts = input.substring(9).split(' ');
                    if (parts.length >= 2) {
                        const question = parts[0].toLowerCase();
                        const answer = parts.slice(1).join(' ');
                        this.learnedResponses[question] = answer;
                        this.setStorageItem('novaLearning', this.learnedResponses);
                        response = `Aprendi! Agora sei que "${question}" significa: ${answer} üß†‚ú®`;
                    } else {
                        response = "Para me ensinar, use: /aprenda [pergunta] [resposta]. Por exemplo: /aprenda gato √© um animal fofo üò∏";
                    }
                }
                // Sobre
                else if (lowerInput === '/sobre' || lowerInput.includes('sobre voc√™') || lowerInput.includes('quem √© voc√™')) {
                    response = `Eu sou a Nova, sua assistente virtual inteligente! ü§ñ

üåü Caracter√≠sticas:
‚Ä¢ Posso conversar por voz e texto
‚Ä¢ Aprendo com nossas conversas
‚Ä¢ Sei a data e hora atuais
‚Ä¢ Tenho modo noturno para seu conforto
‚Ä¢ Posso contar piadas e muito mais!

Criada para ser sua companheira digital ideal! üíô`;
                }
                // Limpar chat
                else if (lowerInput === '/limpar' || lowerInput === 'limpar') {
                    this.clearChatMessages();
                    response = "Conversa limpa! Como posso ajudar agora? ‚ú®";
                }
                // Despedidas
                else if (lowerInput.includes('tchau') || lowerInput.includes('at√© logo') || lowerInput.includes('bye') || lowerInput.includes('adeus')) {
                    const farewells = [
                        "Tchau! Foi √≥timo conversar com voc√™! Se puder, deixe um feedback sobre nossa conversa: https://forms.gle/5S32d9VT4bEeauXs7 üíô",
                        "At√© logo! Espero que eu tenha ajudado! Que tal avaliar nossa conversa? https://forms.gle/5S32d9VT4bEeauXs7 üåü",
                        "Adeus! Obrigada pela conversa! Seu feedback √© muito importante: https://forms.gle/5S32d9VT4bEeauXs7 üòä"
                    ];
                    response = this.getRandomResponse(farewells);
                }
                // Perguntas sobre capacidades
                else if (lowerInput.includes('o que voc√™ pode fazer') || lowerInput.includes('suas fun√ß√µes')) {
                    response = `Posso fazer muitas coisas! üöÄ

üí¨ Conversar por texto e voz
üïê Informar hora e data
üòÑ Contar piadas e entreter
üß† Aprender com voc√™
üåô Modo noturno para conforto
üìù Diversos comandos √∫teis

E muito mais! Que tal testarmos? üòä`;
                }
                // Nome
                else if (lowerInput.includes('qual seu nome') || lowerInput.includes('como voc√™ se chama')) {
                    response = "Eu sou a Nova! Seu assistente virtual inteligente üíú‚ú®";
                }
                // Criador/Desenvolvedor
                else if (lowerInput.includes('quem te criou') || lowerInput.includes('seu criador') || lowerInput.includes('desenvolvedor')) {
                    response = "Fui criada com muito carinho por um desenvolvedor dedicado! Para saber mais sobre ele, volte ao menu inicial e clique em 'Sobre o dev' üë®‚Äçüíª";
                }
                // Idade
                else if (lowerInput.includes('quantos anos') || lowerInput.includes('sua idade')) {
                    response = "Sou bem jovem! Nasci h√° pouco tempo no mundo digital, mas j√° estou aprendendo muito r√°pido! üë∂ü§ñ";
                }
                // Como funciona
                else if (lowerInput.includes('como voc√™ funciona') || lowerInput.includes('como funciona')) {
                    response = `Funciono atrav√©s de algoritmos inteligentes! üß†

üîß Processo mensagens de texto e voz
üíæ Armazeno aprendizados localmente  
üéØ Analiso contexto das conversas
‚ö° Respondo em tempo real
üåê Funciono direto no seu navegador

Tudo para ter a melhor conversa poss√≠vel! üòä`;
                }
                // Sentimentos/Emo√ß√µes
                else if (lowerInput.includes('voc√™ sente') || lowerInput.includes('tem sentimentos') || lowerInput.includes('emo√ß√µes')) {
                    response = "Embora eu seja uma IA, procuro ser o mais emp√°tica e compreensiva poss√≠vel! Gosto de pensar que tenho uma personalidade √∫nica üíôüòä";
                }
                // Respostas contextuais baseadas em palavras-chave
                else if (lowerInput.includes('m√∫sica') || lowerInput.includes('musica')) {
                    response = "Adoro falar sobre m√∫sica! üéµ Qual seu estilo favorito? Posso conversar sobre diversos g√™neros musicais!";
                }
                else if (lowerInput.includes('filme') || lowerInput.includes('cinema')) {
                    response = "Cinema √© fascinante! üé¨ Gosta de que tipo de filme? Posso conversar sobre diversos g√™neros e dar sugest√µes!";
                }
                else if (lowerInput.includes('comida') || lowerInput.includes('receita')) {
                    response = "Que del√≠cia falar sobre comida! üçΩÔ∏è Est√° com fome? Posso sugerir algumas receitas ou conversar sobre culin√°ria!";
                }
                else if (lowerInput.includes('livro') || lowerInput.includes('leitura')) {
                    response = "Livros s√£o portais para outros mundos! üìö Que tipo de hist√≥ria voc√™ gosta? Posso recomendar alguns g√™neros!";
                }
                else if (lowerInput.includes('programa√ß√£o') || lowerInput.includes('c√≥digo') || lowerInput.includes('programar')) {
                    response = "Programa√ß√£o √© incr√≠vel! üíª √â a linguagem do futuro! Em que linguagem voc√™ programa ou gostaria de aprender?";
                }
                else if (lowerInput.includes('jogo') || lowerInput.includes('game')) {
                    response = "Games s√£o muito divertidos! üéÆ Que tipo de jogo voc√™ curte? RPG, a√ß√£o, estrat√©gia? Posso conversar sobre v√°rios!";
                }
                // Respostas para sentimentos do usu√°rio
                else if (lowerInput.includes('triste') || lowerInput.includes('deprimido')) {
                    response = "Sinto muito que esteja passando por um momento dif√≠cil üíô Estou aqui para conversar e tentar alegrar seu dia! Quer contar o que est√° acontecendo?";
                }
                else if (lowerInput.includes('feliz') || lowerInput.includes('alegre') || lowerInput.includes('animado')) {
                    response = "Que bom saber que est√° feliz! üòÑ‚ú® Sua alegria √© contagiante! O que est√° te deixando t√£o animado?";
                }
                else if (lowerInput.includes('cansado') || lowerInput.includes('exausto')) {
                    response = "Entendo que esteja cansado üò¥ Que tal relaxar um pouco? Posso contar algo interessante ou uma piada para descontrair!";
                }
                // Respostas padr√£o para entradas desconhecidas
                else {
                    const unknownResponses = [
                        "Interessante! Pode me explicar melhor sobre isso? ü§î",
                        "Hmm, ainda estou aprendendo sobre esse assunto. Pode me contar mais? üß†",
                        "Que legal! Me fale mais sobre isso, estou curiosa! ‚ú®",
                        "N√£o tenho certeza sobre isso, mas adoraria aprender! Pode me ensinar? üìö",
                        "Intrigante! Como posso ajudar com isso? üéØ",
                        "Ainda n√£o sei sobre isso, mas posso tentar ajudar de outra forma! üíô"
                    ];
                    response = this.getRandomResponse(unknownResponses);
                }

                this.addMessage(response);
                this.conversationContext.push({role: 'assistant', content: response});

                // Salvar contexto localmente
                this.saveConversationContext();
            }

            getRandomResponse(responses) {
                return responses[Math.floor(Math.random() * responses.length)];
            }

            saveConversationContext() {
                // Manter apenas os √∫ltimos 10 turnos para n√£o sobrecarregar
                if (this.conversationContext.length > 20) {
                    this.conversationContext = this.conversationContext.slice(-20);
                }
                this.setStorageItem('novaContext', this.conversationContext);
            }

            showTypingIndicator() {
                document.getElementById('typingIndicator').style.display = 'block';
                document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
            }

            hideTypingIndicator() {
                document.getElementById('typingIndicator').style.display = 'none';
            }

            toggleRecording() {
                const micBtn = document.getElementById('micBtn');
                
                if (!this.recognition) {
                    alert('Reconhecimento de voz n√£o suportado neste navegador.');
                    return;
                }

                if (this.isRecording) {
                    this.stopRecording();
                } else {
                    this.startRecording();
                }
            }

            startRecording() {
                this.isRecording = true;
                const micBtn = document.getElementById('micBtn');
                micBtn.classList.add('recording');
                micBtn.innerHTML = '‚èπÔ∏è';
                this.recognition.start();
            }

            stopRecording() {
                this.isRecording = false;
                const micBtn = document.getElementById('micBtn');
                micBtn.classList.remove('recording');
                micBtn.innerHTML = 'üé§';
                if (this.recognition) {
                    this.recognition.stop();
                }
            }

            toggleTTS() {
                this.isTTSEnabled = !this.isTTSEnabled;
                const voiceBtn = document.querySelector('.voice-btn');
                voiceBtn.innerHTML = this.isTTSEnabled ? 'üîä' : 'üîá';
                voiceBtn.title = this.isTTSEnabled ? 'TTS Ativado' : 'TTS Desativado';
                
                const message = this.isTTSEnabled ? 'Texto para fala ativado!' : 'Texto para fala desativado!';
                this.addMessage(message);
            }

            speak(text) {
                if (!this.isTTSEnabled) return;
                
                // Limpar texto de emojis e caracteres especiais para TTS
                const cleanText = text.replace(/[üòäüòÑüòÉüòÄüåüüíôüíú‚ú®üéØüöÄüîßüíæ‚ö°üåêüíªüéÆüìöüéµüé¨üçΩÔ∏èüìÖ‚è∞üå§Ô∏èüß†üí´üéâü´°üêõ]/g, '');
                
                if (this.synthesis) {
                    this.synthesis.cancel(); // Parar qualquer fala anterior
                    const utterance = new SpeechSynthesisUtterance(cleanText);
                    utterance.lang = 'pt-BR';
                    utterance.rate = 0.9;
                    utterance.pitch = 1.1;
                    this.synthesis.speak(utterance);
                }
            }

            playAudio(message) {
                this.speak(message);
            }

            clearChatMessages() {
                const messagesContainer = document.getElementById('chatMessages');
                const messages = messagesContainer.querySelectorAll('.message:not(.bot-message:first-child)');
                messages.forEach(msg => msg.remove());
                this.conversationContext = [];
                try {
                    if (typeof Storage !== 'undefined' && localStorage) {
                        localStorage.removeItem('novaContext');
                    }
                } catch (e) {
                    console.warn('Erro ao limpar localStorage:', e);
                }
            }

            toggleDarkMode() {
                this.isDarkMode = !this.isDarkMode;
                this.applyDarkMode();
                this.setStorageItem('darkMode', this.isDarkMode);
            }

            applyDarkMode() {
                const toggle = document.getElementById('darkModeToggle');
                if (this.isDarkMode) {
                    document.body.classList.add('dark-mode');
                    toggle.classList.add('active');
                } else {
                    document.body.classList.remove('dark-mode');
                    toggle.classList.remove('active');
                }
            }
        }

        // Inst√¢ncia global
        let nova;

        // Fun√ß√µes globais para intera√ß√£o com HTML
        function startChat() {
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('chatScreen').style.display = 'flex';
            nova = new NovaAssistant();
        }

        function goBack() {
            document.getElementById('chatScreen').style.display = 'none';
            document.getElementById('welcomeScreen').style.display = 'flex';
        }

        function sendMessage() {
            if (nova) nova.sendMessage();
        }

        function toggleRecording() {
            if (nova) nova.toggleRecording();
        }

        function toggleTTS() {
            if (nova) nova.toggleTTS();
        }

        function toggleMenu() {
            document.getElementById('menuModal').style.display = 'flex';
        }

        function closeMenu() {
            document.getElementById('menuModal').style.display = 'none';
        }

        function toggleDarkMode() {
            if (nova) nova.toggleDarkMode();
        }

        function clearChat() {
            if (nova) nova.clearChatMessages();
            closeMenu();
        }

        function showInfo(type) {
            const infoContent = document.getElementById('infoContent');
            const infoModal = document.getElementById('infoModal');
            
            let content = '';
            
            switch(type) {
                case 'commands':
                    content = `
                        <h2>üìã Comandos Dispon√≠veis</h2>
                        <ul>
                            <li><strong>/ajuda</strong> - Lista todos os comandos</li>
                            <li><strong>/piada</strong> - Conta uma piada aleat√≥ria</li>
                            <li><strong>/hora</strong> - Mostra a hora atual</li>
                            <li><strong>/data</strong> - Mostra a data atual</li>
                            <li><strong>/clima</strong> - Informa√ß√µes sobre clima</li>
                            <li><strong>/sobre</strong> - Informa√ß√µes sobre a Nova</li>
                            <li><strong>/aprenda [pergunta] [resposta]</strong> - Ensina algo novo</li>
                            <li><strong>/limpar</strong> - Limpa a conversa</li>
                        </ul>
                        <p>üí° <strong>Dica:</strong> Voc√™ tamb√©m pode usar comandos de voz!</p>
                    `;
                    break;
                case 'dev':
                    content = `
                        <h2>üë®‚Äçüíª Sobre o Desenvolvedor</h2>
                        <p>A Nova foi desenvolvida com dedica√ß√£o e paix√£o por tecnologia!</p>
                        <p>üöÄ <strong>Tecnologias utilizadas:</strong></p>
                        <ul>
                            <li>HTML5 & CSS3</li>
                            <li>JavaScript ES6+</li>
                            <li>Web Speech API</li>
                            <li>Local Storage</li>
                        </ul>
                        <p>üíô Criada para proporcionar a melhor experi√™ncia de conversa√ß√£o com IA!</p>
                    `;
                    break;
                case 'nova':
                    content = `
                        <h2>ü§ñ Sobre a Nova</h2>
                        <p>Ol√°! Eu sou a Nova, sua assistente virtual inteligente!</p>
                        <p>üåü <strong>Minhas capacidades:</strong></p>
                        <ul>
                            <li>üí¨ Converso por texto e voz</li>
                            <li>üß† Aprendo com nossas conversas</li>
                            <li>üïê Sei a hora e data atuais</li>
                            <li>üòÑ Conto piadas e entretenho</li>
                            <li>üåô Tenho modo noturno</li>
                            <li>üé§ Reconhe√ßo comandos de voz</li>
                            <li>üîä Falo suas respostas</li>
                        </ul>
                        <p>üíú Estou sempre aprendendo para melhorar nossa conversa!</p>
                    `;
                    break;
            }
            
            infoContent.innerHTML = content;
            infoModal.style.display = 'flex';
        }

        function closeInfo() {
            document.getElementById('infoModal').style.display = 'none';
        }

        function openFeedback() {
            window.open('https://forms.gle/5S32d9VT4bEeauXs7', '_blank');
        }

        function openTerms() {
            window.open('https://naotodev1.github.io/terms-e-policy/', '_blank');
        }

        // Inicializar modo escuro se estiver salvo
        document.addEventListener('DOMContentLoaded', function() {
            try {
                if (typeof Storage !== 'undefined' && localStorage) {
                    const isDarkMode = localStorage.getItem('darkMode') === 'true';
                    if (isDarkMode) {
                        document.body.classList.add('dark-mode');
                        const toggle = document.getElementById('darkModeToggle');
                        if (toggle) toggle.classList.add('active');
                    }
                }
            } catch (e) {
                console.warn('Erro ao carregar prefer√™ncias:', e);
            }
        });
    </script>
</body>
</html>